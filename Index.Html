<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>iPlex</title>
<!-- Font Awesome for icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
<style>
  :root {
    --primary-green: #00ff88;
    --dark-bg: #1a1a1a;
    --card-bg: #242424;
    --text-color: #ffffff;
  }
  body {
    margin: 0;
    font-family: 'Inter', sans-serif;
    background-color: var(--dark-bg);
    color: var(--text-color);
    padding-top: 60px;
  }

  /* Header Styles */
  .header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    padding: 8px 18px;
    border-radius: 0px;
    border: 1px solid #363636;
    background-color: rgba(30, 30, 30, 0.95);
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  .logo-container {
    display: flex;
    font-size: 1.1rem;
    font-weight: 800;
    color: #fff;
    align-items: center;
    gap: 10px;
  }
  .logo {
    height: 35px;
    width: auto;
  }
  .header-icons {
    display: flex;
    font-size: 20px;
    gap: 15px;
    align-items: center;
  }
  .search {
    background-color: #333;
    border-radius: 15px;
    padding: 5px 10px;
    display: flex;
    margin-left: 10px;      
    align-items: center;
    border: 1px solid #444;
  }
  .search input {
    border: none;
    background: transparent;
    color: #fff;
    outline: none;
    margin-left: 10px;
    font-size: 0.95rem;
    width: 100%;
  }

  /* Sidebar Menu */
  .sidebar-menu {
    position: fixed;
    top: 0;
    right: -300px;
    width: 200px;
    height: 100%;
    background-color: #2a2a2a;
    transition: 0.3s;
    z-index: 2000;
    padding: 20px;
    box-shadow: -2px 0 15px rgba(0, 0, 0, 0.2);
  }
  .sidebar-menu.active {
    right: 0;
  }
  .menu-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0px 15px;
    border-radius: 50px;
    border: 1px solid #555;
  }
  .close-menu {
    background-color: #333;
    color: #ccc;
    font-size: 28px;
    padding: 0px 4px;
    border-radius: 50px;
    cursor: pointer;
  }
  .social-media-list {
    list-style: none;
    padding: 0;
  }
  .social-media-item {
    margin: 15px 0;
    display: flex;
    align-items: center;
    color: #fff;
    text-decoration: none;
    transition: 0.3s;
  }
  .social-media-item:hover {
    color: #ffcc00;
    transform: translateX(10px);
  }
  .social-media-item i {
    font-size: 20px;
    width: 30px;
    margin-right: 15px;
  }
  .menu-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 1999;
    display: none;
  }

  /* Movie Sections and Search Results */
  .section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0px 20px;
  }
  .section-title {
    font-weight: 700;
    font-size: 1.2rem;
    color: var(--text-color);
    display: flex;
    gap: 15px;
  }
  .view-all-btn {
    background: #ffcc00;
    color: #000;
    border: none;
    padding: 6px 10px;
    border-radius: 20px;
    cursor: pointer;
    font-weight: 300;
    transition: all 0.3s ease;
  }
  .view-all-btn:hover {
    opacity: 0.9;
  }
  .card-row {
    display: flex;
    overflow-x: auto;      
    gap: 11px;
    padding: 0px 20px;
    scrollbar-width: thin;
    scrollbar-color: #363636 transparent;
  }
  .card-row::-webkit-scrollbar {
    display: none;
  }
  .card-row.grid-view {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
    overflow-x: hidden;
  }
  .movie-card {
    background: var(--card-bg);
    border-radius: 16px;
    overflow: hidden;
    text-decoration: none;
    color: inherit;
    transition: transform 0.2s ease;
    border: 1px solid #363636;
    min-width: 80px;
    flex-shrink: 0;
    position: relative;
  }
  .grid-view .movie-card {
    min-width: auto;
  }
  .movie-card:hover {
    transform: translateY(-5px);
  }
  .movie-card img {
    width: 100%;
    height: 160px;
    object-fit: cover;
    border-bottom: 2px solid #363636;
  }
  .movie-info {
    padding: 10px;
    position: relative;
  }
  .movie-title {
    font-weight: 600;
    margin-bottom: 5px;
    font-size: 0.65rem;
    color: var(--text-color);
  }
  .provider-tag {
    position: absolute;
    bottom: 10px;
    left: 10px;
    background: rgba(0, 0, 0, 0.6);
    padding: 4px 8px;
    border-radius: 6px;
    font-size: 0.7rem;
    backdrop-filter: blur(4px);
  }
  .favorite-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    background: rgba(0, 0, 0, 0.6);
    border: none;
    color: white;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    cursor: pointer;
    backdrop-filter: blur(4px);
    transition: all 0.2s ease;
  }
  .favorite-btn:hover {
    color: var(--primary-green);
  }

  /* History Styles */
  .history-icon {
    font-size: 20px;
    cursor: pointer;
    color: #ccc;
  }
  .history-icon:hover {
    color: #ffcc00;
  }
  .history-modal {
    display: none;
    position: fixed;
    top: 80px;
    right: 10px;
    width: 320px;
    max-height: 80vh;
    overflow-y: auto;
    background-color: #121212;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    z-index: 1000;
    padding: 10px;
  }
  .history-modal.open {
    display: block;
  }
  .history-modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .history-modal-header h3 {
    font-size: 16px;
    margin: 0;
    color: #fff;
  }
  #closeHistoryModal {
    background: none;
    border: none;
    font-size: 20px;
    color: #fff;
    cursor: pointer;
  }
  .history-list {
    margin-top: 10px;
  }
  .history-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 0;
    border-bottom: 1px solid #333;
  }
  .history-item img {
    width: 80px;
    height: 100px;
    object-fit: cover;
    border-radius: 5px;
  }
  .history-item .content {
    flex: 1;
  }
  .history-item h4 {
    font-size: 11px;
    margin: 0;
    color: #fff;
    cursor: pointer;
  }
  .history-item p {
    font-size: 12px;
    margin: 0;
    color: #aaa;
  }
  .watch-button {
    background-color: #ffcc00;
    color: #000;
    border: 1px solid #ccc;
    padding: 5px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 9px;
    text-decoration: none;
  }
  .clear-history-button {
    width: 100%;
    margin-top: 10px;
    background-color: #ffcc00;
    border: none;
    padding: 10px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
  }

  /* Carousel Styles */
    .carousel-container {
      width: 100%;  
      max-width: 600px;  
      height: 209px;  
      overflow: hidden;
      position: relative;
      border-radius: 8px;
      border: 1px solid #363636;
      touch-action: pan-y;
    }

    .carousel {
      display: flex;
      transition: transform 0.4s ease-in-out;
      will-change: transform;
    }

    .slide {
      min-width: 100%;
      height: 100%;
      position: relative;
      user-select: none;
    }

    .slide img {
      width: 100%;
      height: 100%;
      object-fit: cover; 
      border-radius: 10px;
    }

    .overlay {
      position: absolute;
      bottom: 0;
      width: 100%;
      height: 40%;
      background: linear-gradient(to top, rgba(0, 0, 0, 0.9), transparent);
      border-radius: 10px;
    }

    .video-title {
      position: absolute;
      bottom: 16px;
      left: 15px;
      font-size: 18px;
      font-weight: bold;
    }

    .download-btn {
      position: absolute;
      bottom: 15px;
      right: 15px;
      background: #ffcc00;
      color: black;
      font-size: 12px;
      padding: 8px 10px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .download-btn img {
      width: 14px;
      height: 14px;
    }

    .dots {
      position: absolute;
      bottom: 5px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 5px;
    }

    .dot {
      width: 8px;
      height: 8px;
      background-color: gray;
      border-radius: 50%;
      cursor: pointer;
      transition: 0.3s;
    }

    .dot.active {
      background-color: #ffcc00;
    }

  /* Search Results */
  #searchResults {
    display: none;
    padding: 20px;
  }
  #searchResults h3 {
    margin-bottom: 10px;
  }
  #resultsList {
    list-style: none;
    padding: 0;
  }
  #resultsList li {
    margin-bottom: 10px;
  }
  #resultsList li a {
    color: #ffcc00;
    text-decoration: none;
  }
  #resultsList li a:hover {
    text-decoration: underline;
  }

  /* Ad Container Styles - bottom bar */
  .ad-container {
    position: fixed;
    bottom: 0;
    width: 95%;
    background: #fff;
    border: 1px solid #ccc;
    box-shadow: 0 -2px 8px rgba(0,0,0,0.2);
    padding: 8px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    z-index: 1000;
    display: none; /* hidden initially */
  }
  .ad-wrapper {
    display: flex;
    align-items: center;
    flex: 1;
    overflow: hidden;
  }
  .ad-content {
    display: flex;
    align-items: center;
    flex-grow: 1;
    overflow: hidden;
  }
  .app-icon {
    width: 50px;
    height: 50px;
    border-radius: 12px;
    overflow: hidden;
    margin-right: 10px;
    flex-shrink: 0;
  }
  .app-icon img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  .ad-info {
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }
  .app-name {
    font-weight: bold;
    font-size: 16px;
    color: #333;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 200px;
    margin-bottom: 4px;
  }
  .ad-meta {
    font-size: 14px;
    color: #555;
    white-space: nowrap;
  }
  .install-button {
    background-color: #007bff;
    color: white;
    padding: 8px 14px;
    border: none;
    border-radius: 20px;
    font-weight: bold;
    cursor: pointer;
    text-decoration: none;
    margin-left: 10px;
    flex-shrink: 0;
  }
  .install-button:hover {
    background-color: #0056b3;
  }

  /* Ad Overlay */
    .ad-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.3);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 999;
    }

    .ad-popup {
      position: relative;
      width: 100%;
      max-width: 250px;
      border-radius: 15px;
      text-align: center;
      cursor: pointer;
    }

    .ad-popup img {
      width: 100%;
      border-radius: 15px;
      display: block;
    }

    .ad-popup .close-btn {
      position: absolute;
      top: 7px;
      right: 10px;
      background: rgba(0, 0, 0, 0.2);
      color: white;
      border: none;
      padding: 0px;
      font-size: 20px;
      cursor: pointer;
      border-radius: 50%;
    }
</style>
</head>
<body>

<!-- Header -->
<div class="sticky-container">
  <header class="header">
    <div class="logo-container">
      <img src="https://bit.ly/3ENxGyn" alt="Movie Gram Logo" class="logo" />
      <span>iPlex</span>
    </div>
    <div class="header-icons" role="navigation">
      <div class="search" role="search">
        <i class="fas fa-search"></i>
        <input type="text" id="searchInput" placeholder="Search..." aria-label="Search Movies" />
      </div>
      <i class="fas fa-history history-icon" id="historyButton"></i>
      <button id="menu-toggle" aria-label="Open Menu"><i class="fas fa-bars"></i></button>
    </div>
  </header>
</div>

<!-- Sidebar Menu -->
<div class="sidebar-menu" id="sidebar">
  <div class="menu-header">
    <h2></h2>
    <span class="close-menu" id="close-menu">×</span>
  </div>
  <ul class="social-media-list">
    <li><a href="#" class="social-media-item"><i class="fab fa-facebook"></i>Facebook</a></li>
    <li><a href="#" class="social-media-item"><i class="fab fa-twitter"></i>Twitter</a></li>
    <li><a href="#" class="social-media-item"><i class="fab fa-instagram"></i>Instagram</a></li>
    <li><a href="#" class="social-media-item"><i class="fab fa-youtube"></i>YouTube</a></li>
  </ul>
</div>
<div class="menu-overlay" id="overlay"></div>

<!-- History Modal -->
<div class="history-modal" id="historyModal">
  <div class="history-modal-header">
    <h3>Watch History</h3>
    <button id="closeHistoryModal">×</button>
  </div>
  <div class="history-list" id="historyList"></div>
  <button class="clear-history-button" id="clearHistory">Clear All History</button>
</div>

<!-- Carousel -->
<div class="carousel-container">
  <div class="carousel" id="carousel"></div>
  <div class="dots" id="dots"></div>
</div>

<!-- Search Results -->
<div class="search-results" id="searchResults">
  <h3>Search Results:</h3>
  <ul id="resultsList"></ul>
</div>

<!-- Main Content with Movie Sections -->
<main>
  <!-- Featured Movies -->
  <div class="section-header">
    <div class="section-title" aria-labelledby="featured">
      <h2 id="featured">Featured</h2>
    </div>
    <button class="view-all-btn" data-section="featured-movies">All<i class="fas fa-chevron-right"></i></button>
  </div>
  <div class="card-row" id="featured-movies"></div>

  <!-- Popular Movies -->
  <div class="section-header">
    <div class="section-title" aria-labelledby="popular">
      <h2 id="popular">Popular</h2>
    </div>
    <button class="view-all-btn" data-section="popular-movies">All<i class="fas fa-chevron-right"></i></button>
  </div>
  <div class="card-row" id="popular-movies"></div>

  <!-- New Releases -->
  <div class="section-header">
    <div class="section-title" aria-labelledby="new-releases">
      <h2 id="new-releases">New Releases</h2>
    </div>
    <button class="view-all-btn" data-section="new-releases-movies">All<i class="fas fa-chevron-right"></i></button>
  </div>
  <div class="card-row" id="new-releases-movies"></div>
</main>

<!-- Ad Container (bottom bar) -->
<div class="ad-container" id="adContainer">
  <div class="ad-wrapper" id="adWrapper">
    <div class="ad-content" id="adContent"></div>
  </div>
  <a href="#" id="installButton" class="install-button" target="_blank">Install</a>
</div>

<!-- Popup Ad Overlay -->
<div id="adOverlay">
  <div id="adPopup">
    <button class="close-btn" onclick="closePopupAd()" aria-label="Close ad">✖</button>
    <img id="popupAdImage" src="" alt="Ad Image" onclick="goToPopupAdLink()" />
  </div>
</div>

<script>
  // --- Movie Data ---
const moviesData = {
  featured: [
    {
      title: "GIDAN SARAUTA",
      year: 2014,
      img: "https://short-link.me/TsCr",
      provider: "",
      link: "https://gidan-sarauta.netlify.app/"
    },
    {
      title: "RAMIN QRYA",
      year: 2008,
      img: "https://bit.ly/3GwPP41",
      provider: "",
      link: "#"
    },
    {
      title: "ALAQA",
      year: 2010,
      img: "https://short-link.me/QSiT",
      provider: "",
      link: "https://myportal-nimc-gov-ng.netlify.app/"
    },
    {
      title: "BABY",
      year: 1994,
      img: "https://bit.ly/4388onP",
      provider: "",
      link: "#"
    }
  ],
  popular: [
    {
      title: "GIDAN SARAUTA",
      year: 2014,
      img: "https://bit.ly/3RHwpvz",
      provider: "",
      link: "https://gidan-sarauta.netlify.app/"
    },
    {
      title: "JAMILUN JIDDA",
      year: 1972,
      img: "https://bit.ly/3GLvlo1",
      provider: "",
      link: "#"
    },
    {
      title: "RANA DUBU",
      year: 1994,
      img: "https://bit.ly/44OiH1D",
      provider: "",
      link: "#"
    },
    {
      title: "Fight Club",
      year: 1999,
      img: "https://m.media-amazon.com/images/I/71YFoZiv-9L._SL1500_.jpg",
      provider: "",
      link: "#"
    }
  ],
  newReleases: [
    {
      title: "Dune",
      year: 2021,
      img: "https://m.media-amazon.com/images/I/91KkWf50SoL._SL1500_.jpg",
      provider: "",
      link: "#"
    },
    {
      title: "No Time to Die",
      year: 2021,
      img: "https://m.media-amazon.com/images/I/91KkWf50SoL._SL1500_.jpg",
      provider: "",
      link: "#"
    },
    {
      title: "Spider-Man: No Way Home",
      year: 2021,
      img: "https://m.media-amazon.com/images/I/71VrNJc1YtL._SL1500_.jpg",
      provider: "Sony Pictures",
      link: "#"
    },
    {
      title: "The Batman",
      year: 2022,
      img: "https://m.media-amazon.com/images/I/71UwEne3eqL._SL1500_.jpg",
      provider: "Warner Bros",
      link: "#"
    }
  ]
};

// --- Ad Data ---
const apps = [
  {
    name: "Cheelee: Short Videos f...",
    icon: "https://tinylink.info/119AL",
    rating: "4.5",
    link: "https://tinylink.info/119Aa"
  },
  {
    name: "CoolApp",
    icon: "https://tinylink.info/119A0",
    rating: "4.8",
    link: "https://tinylink.info/YchD"
  },
  {
    name: "Z League: Mini Games & Friends",
    icon: "https://tinylink.info/Ycg4",
    rating: "4.0",
    link: "https://tinylink.info/119yG"
  }
];

// Elements for bottom ad bar
const adContainer = document.getElementById('adContainer');
const adContent = document.getElementById('adContent');
const installButton = document.getElementById('installButton');

// Elements for popup ad
const adOverlay = document.getElementById('adOverlay');
const popupAdImage = document.getElementById('popupAdImage');

let currentAdIndex = parseInt(localStorage.getItem('currentAdIndex')) || 0;
let popupAdIndex = 0;

// --- Functions for bottom ad ---
function showAd(index) {
  const app = apps[index];
  adContent.innerHTML = `
    <div class="app-icon">
      <img src="${app.icon}" alt="App Icon" />
    </div>
    <div class="ad-info">
      <div class="app-name">${app.name}</div>
      <div class="ad-meta">
        <span class="sponsored">Sponsored ·</span>
        <span>${app.rating} ★ FREE</span>
      </div>
    </div>`;
  installButton.href = app.link;
  adContainer.style.display = 'flex';

  localStorage.setItem('currentAdIndex', index);
}

function rotateAds() {
  showAd(currentAdIndex);
  currentAdIndex = (currentAdIndex + 1) % apps.length;
}

// --- Functions for popup ad ---
function showPopupAd() {
  popupAdIndex = Math.floor(Math.random() * apps.length);
  const app = apps[popupAdIndex];
  // Placeholder image; replace with actual ad image URL if available
  popupAdImage.src = "https://via.placeholder.com/250x150?text=Ad";
  // Optional: set link dynamically if you have specific images
  adOverlay.style.display = 'flex';
  localStorage.setItem('popupAdIndex', popupAdIndex);
}

function goToPopupAdLink() {
  const app = apps[popupAdIndex];
  window.open(app.link, "_blank");
}

function closePopupAd() {
  adOverlay.style.display = 'none';
}

// --- Initialize ads ---
showAd(currentAdIndex);
setInterval(rotateAds, 15000); // Rotate bottom ad every 15 sec
// Show popup ad every 30 seconds
setTimeout(() => {
  showPopupAd();
  setInterval(showPopupAd, 30000);
}, 1000);

// --- Movie Card Creation ---
function createMovieCard(movie) {
  return `
    <div class="movie-card" data-title="${movie.title}" data-link="${movie.link}">
      <button class="favorite-btn" aria-label="Add to favorites"><i class="far fa-heart"></i></button>
      <img src="${movie.img}" alt="${movie.title} Poster" />
      <div class="provider-tag">${movie.provider}</div>
      <div class="movie-info">
        <div class="movie-title">${movie.title} (${movie.year})</div>
      </div>
    </div>
  `;
}

// --- Render Movies ---
function renderMovies() {
  document.getElementById('featured-movies').innerHTML = moviesData.featured.map(createMovieCard).join('');
  document.getElementById('popular-movies').innerHTML = moviesData.popular.map(createMovieCard).join('');
  document.getElementById('new-releases-movies').innerHTML = moviesData.newReleases.map(createMovieCard).join('');
}

// --- Menu toggle ---
const menuToggle = document.getElementById('menu-toggle');
const sidebar = document.getElementById('sidebar');
const overlay = document.getElementById('overlay');
const closeMenuBtn = document.getElementById('close-menu');

menuToggle.addEventListener('click', () => {
  sidebar.classList.add('active');
  overlay.style.display = 'block';
});
closeMenuBtn.addEventListener('click', () => {
  sidebar.classList.remove('active');
  overlay.style.display = 'none';
});
overlay.addEventListener('click', () => {
  sidebar.classList.remove('active');
  overlay.style.display = 'none';
});

// --- Watch History ---
let watchHistory = JSON.parse(localStorage.getItem('watchHistory')) || [];
const historyModal = document.getElementById('historyModal');
const historyList = document.getElementById('historyList');

function updateHistoryUI() {
  historyList.innerHTML = watchHistory.map(item => `
    <div class="history-item">
      <img src="${item.img}" alt="${item.title}">
      <div class="content">
        <h4 onclick="window.open('${item.link}', '_blank')">${item.title}</h4>
        <p>Viewed: ${new Date(item.timestamp).toLocaleString()}</p>
      </div>
      <a href="${item.link}" class="watch-button" target="_blank">Watch</a>
    </div>
  `).join('');
}
function addToHistory(title, img, link) {
  const movie = { title, img, link, timestamp: Date.now() };
  watchHistory = watchHistory.filter(i => i.title !== title);
  watchHistory.unshift(movie);
  if (watchHistory.length > 10) watchHistory.pop();
  localStorage.setItem('watchHistory', JSON.stringify(watchHistory));
  updateHistoryUI();
}

document.addEventListener('click', (event) => {
  const card = event.target.closest('.movie-card');
  if (card) {
    const title = card.dataset.title;
    const link = card.dataset.link;
    const img = card.querySelector('img').src;
    window.open(link, '_blank');
    addToHistory(title, img, link);
  }
});

document.getElementById('historyButton').addEventListener('click', () => {
  document.getElementById('historyModal').classList.toggle('open');
  updateHistoryUI();
});
document.getElementById('closeHistoryModal').addEventListener('click', () => {
  document.getElementById('historyModal').classList.remove('open');
});
document.getElementById('clearHistory').addEventListener('click', () => {
  watchHistory = [];
  localStorage.removeItem('watchHistory');
  updateHistoryUI();
});
document.addEventListener('click', (e) => {
  if (!e.target.closest('.history-modal') && !e.target.closest('#historyButton')) {
    document.getElementById('historyModal').classList.remove('open');
  }
});

// --- View all toggle ---
document.querySelectorAll('.view-all-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    const sectionId = btn.dataset.section;
    const section = document.getElementById(sectionId);
    const isGrid = section.classList.contains('grid-view');
    section.classList.toggle('grid-view');
    btn.innerHTML = isGrid ? 'All<i class="fas fa-chevron-right"></i>' : 'Collapse';
    if (!isGrid) section.scrollIntoView({ behavior: 'smooth' });
  });
});

// --- Carousel ---
const videos = [
  { img: "https://bit.ly/3GL4Yi4", title: "GIDAN SARAUTA", buttonTitle: "Free Download", link: "https://short-link.me/QSiT" },
  { img: "https://bit.ly/4d2G5uC", title: "RAMIN QRYA", buttonTitle: "Watch Now", link: "https://example.com/fast10" },
  { img: "https://bit.ly/3RHwpvz", title: "Avatar 2", buttonTitle: "Stream Now", link: "https://example.com/avatar2" },
  { img: "https://bit.ly/3RHwpvz", title: "Mission Impossible 7", buttonTitle: "Download", link: "https://example.com/mi7" }
];

const carousel = document.getElementById("carousel");
const dotsContainer = document.getElementById("dots");
let currentIndex = 0;
let startX = 0;
let moveX = 0;
let isDragging = false;

function createSlides() {
  videos.forEach((video, index) => {
    const slide = document.createElement("div");
    slide.className = "slide";
    slide.innerHTML = `
      <a href="${video.link}" target="_blank" style="display:block; height:100%;">
        <img src="${video.img}" alt="${video.title}">
      </a>
      <div class="overlay"></div>
      <div class="video-title">${video.title}</div>
      <button class="download-btn" onclick="window.open('${video.link}', '_blank'); event.stopPropagation();">
        <img src="https://cdn-icons-png.flaticon.com/128/3874/3874990.png" alt="Download" />${video.buttonTitle}
      </button>
    `;
    carousel.appendChild(slide);
    const dot = document.createElement("div");
    dot.className = "dot" + (index === 0 ? " active" : "");
    dot.addEventListener("click", () => goToSlide(index));
    dotsContainer.appendChild(dot);
  });
}
function updateCarousel() {
  carousel.style.transform = `translateX(-${currentIndex * 100}%)`;
  document.querySelectorAll(".dot").forEach((dot, index) => {
    dot.classList.toggle("active", index === currentIndex);
  });
}
function goToSlide(index) {
  currentIndex = index;
  updateCarousel();
}
function nextSlide() {
  currentIndex = (currentIndex + 1) % videos.length;
  updateCarousel();
}
function prevSlide() {
  currentIndex = (currentIndex - 1 + videos.length) % videos.length;
  updateCarousel();
}

// Swipe support
const carouselEl = document.getElementById("carousel");
carouselEl.addEventListener("touchstart", handleTouchStart);
carouselEl.addEventListener("touchmove", handleTouchMove);
carouselEl.addEventListener("touchend", handleTouchEnd);
carouselEl.addEventListener("mousedown", handleMouseDown);
carouselEl.addEventListener("mousemove", handleMouseMove);
carouselEl.addEventListener("mouseup", handleMouseUp);
carouselEl.addEventListener("mouseleave", handleMouseUp);

function handleTouchStart(e) {
  startX = e.touches[0].clientX;
  isDragging = true;
}
function handleTouchMove(e) {
  if (!isDragging) return;
  moveX = e.touches[0].clientX - startX;
}
function handleTouchEnd() {
  if (!isDragging) return;
  isDragging = false;
  if (moveX > 50) prevSlide();
  else if (moveX < -50) nextSlide();
  moveX = 0;
}
function handleMouseDown(e) {
  startX = e.clientX;
  isDragging = true;
}
function handleMouseMove(e) {
  if (!isDragging) return;
  moveX = e.clientX - startX;
}
function handleMouseUp() {
  if (!isDragging) return;
  isDragging = false;
  if (moveX > 50) prevSlide();
  else if (moveX < -50) nextSlide();
  moveX = 0;
}

// Initialize carousel
createSlides();
setInterval(nextSlide, 5000);

// --- Search ---
document.getElementById('searchInput').addEventListener('input', (e) => {
  const searchTerm = e.target.value.toLowerCase();
  const movieCards = document.querySelectorAll('.movie-card');
  const searchResultsDiv = document.getElementById('searchResults');
  const resultsList = document.getElementById('resultsList');

  if (searchTerm === '') {
    searchResultsDiv.style.display = 'none';
    document.querySelector('.carousel-container').style.display = 'block';
    movieCards.forEach(c => c.style.display = 'block');
    return;
  }

  resultsList.innerHTML = '';
  movieCards.forEach(c => c.style.display = 'none');
  document.querySelector('.carousel-container').style.display = 'none';

  // Search movies
  Object.values(moviesData).forEach(section => {
    section.forEach(movie => {
      if (movie.title.toLowerCase().includes(searchTerm)) {
        const li = document.createElement('li');
        li.innerHTML = `<a href="${movie.link}" target="_blank">${movie.title} (${movie.year})</a>`;
        resultsList.appendChild(li);
      }
    });
  });
  if (resultsList.children.length > 0) {
    document.getElementById('searchResults').style.display = 'block';
  } else {
    document.getElementById('searchResults').style.display = 'none';
  }
});

// --- Initialize movies and history ---
renderMovies();
updateHistoryUI();

// --- Show ads periodically ---
setTimeout(() => {
  showPopupAd();
  setInterval(showPopupAd, 30000);
}, 1000);

setInterval(rotateAds, 15000);

// --- Functions for bottom ad ---
function showAd(index) {
  const app = apps[index];
  adContent.innerHTML = `
    <div class="app-icon">
      <img src="${app.icon}" alt="App Icon" />
    </div>
    <div class="ad-info">
      <div class="app-name">${app.name}</div>
      <div class="ad-meta">
        <span class="sponsored">Sponsored ·</span>
        <span>${app.rating} ★ FREE</span>
      </div>
    </div>`;
  document.getElementById('installButton').href = app.link;
  adContainer.style.display = 'flex';
  localStorage.setItem('currentAdIndex', index);
}
function rotateAds() {
  showAd(currentAdIndex);
  currentAdIndex = (currentAdIndex + 1) % apps.length;
}

// --- Functions for popup ad ---
function showPopupAd() {
  popupAdIndex = Math.floor(Math.random() * apps.length);
  const app = apps[popupAdIndex];
  popupAdImage.src = "https://via.placeholder.com/250x150?text=Ad"; // Placeholder, replace as needed
  adOverlay.style.display = 'flex';
  localStorage.setItem('popupAdIndex', popupAdIndex);
}
function goToPopupAdLink() {
  const app = apps[popupAdIndex];
  window.open(app.link, "_blank");
}
function closePopupAd() {
  adOverlay.style.display = 'none';
}

// Initialize
showAd(currentAdIndex);
</script>
</body>
</html>
